<header id="authors-header" class="clearfix" role="banner">
    <div id="header-top" class="clearfix">
        <center>
            <img src="/images/banner_randall.jpg" alt="Randall Library">
        </center>
    </div>
</header>

<div class="location-filter">
    <div class="input-group input-group-lg">
    <div class="input-group-prepend">
        <label class="input-group-text" for="">Location</label>
    </div>
    <select class="custom-select" id="location-select">
        <option {{isSelected carousels.pageType 'gen'}} value="gen">General Collection</option>
        <option {{isSelected carousels.pageType 'gov'}} value="gov">Government Resources</option>
        <option {{isSelected carousels.pageType 'juv'}} value="juv">Juvenile Collection</option>
        <option {{isSelected carousels.pageType 'new'}} value="new">New and Popular Collection</option>
        <option {{isSelected carousels.pageType 'cds'}} value="cds">CDs</option>
        <option {{isSelected carousels.pageType 'dvds'}} value="dvds">DVDs</option>
        <option {{isSelected carousels.pageType 'ebooks'}} value="ebooks">ebooks</option>
        <option {{isSelected carousels.pageType 'evideos'}} value="evideos">Streaming Videos</option>
        <option {{isSelected carousels.pageType 'audiobooks'}} value="audiobooks">Audiobooks</option>
    </select>
    <script>
        $(function(){
            $('#location-select').on('change', function () {
                var location = $(this).val(); 
                if (location) {
                    window.location = '/readbox?location=' + location;
                }
                return false;
            });
        });
    </script>
    </div>
</div>

{{#each carousels.rows}}
    <!-- Each carousel row uses this same template -->
    <div class="row mb-5 mt-3 book-row">
        <div class="card book-card">
            <div class="card-body">
                <!-- row title elem -->
                <h5 class="card-title">
                    {{this.title}}
                </h5>
                <!-- carousel items -->
                <div id="carousel-slide-{{increment @index}}" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        {{#each this.items}}
                        <!-- each chunk of 5 items, i.e, 5 books, cds, etc -->
                        <div class="carousel-item {{#unless @index}}active{{/unless}}">
                            <div class="row justify-content-center">
                                {{#each this}}
                                <!-- each item in the chunk, i.e., a book, cd, etc -->
                                <div class="syn_skipthis col-auto book-div">
                                    <img class="img img-thumbnail" src="{{this.image}}">
                                    <a href="#" data-toggle="modal" data-target="#itemInfoModal" onclick="updateModal('{{safeStr this.isbn}}', '{{safeStr this.UPC}}', '{{safeStr this.title}}', '{{safeStr this.titleFixed}}', '{{safeStr this.authorFixed}}', '{{safeStr this.callNumber}}', '{{safeStr this.resLocation}}', '/images/book{{onetwothree @index}}.jpg', '{{changeStr this.available}}', '{{this.recordnum}}')">
                                        <div class="overlay">
                                            <div class="text">
                                                {{this.titleFixed}} - {{this.authorFixed}}
                                            </div>
                                        </div>
                                    </a>
                                    <div class="availability">
                                        {{#if this.available}}
                                        <span class="green"><i class="fas fa-check-circle"></i> Available</span>
                                        {{else}}
                                        <span class="red"><i class="fas fa-times-circle"></i> Unavailable</span>
                                        {{/if}}
                                    </div>
                                </div>
                                {{/each}}
                            </div>
                        </div>
                        {{/each}}
                    </div>
                    <a class="carousel-control-prev" href="#carousel-slide-{{increment @index}}" role="button" data-slide="prev">
                        <span style="color:Black;">
                            <i class="fas fa-arrow-circle-left fa-3x"></i>
                        </span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carousel-slide-{{increment @index}}" role="button" data-slide="next">
                        <span style="color:Black;">
                            <span class="fas fa-arrow-circle-right fa-3x"></span>
                        </span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
{{/each}}

<div style="text-align:center;">
    <div class="col-auto">
        <iframe src="https://popular-books.libapps.uncw.edu/portrait" style="width:100%; height:975px;"></iframe>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="itemInfoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="sendAsTextIframe"></div>
            {{#if showFindIt}}
            <div id="findItIframe"></div>
            {{/if}}
            <div id="modalBodyImage" class="modal-body"></div>
            <div id="modalBodyInfo" class="modal-body" style="padding:.3rem;"></div>
            <div id="modalBodyDescription" class="modal-body"></div>
            <div id="sendAsText" class="modal-body"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    $('#carousel-slide-1').carousel({ interval: 10000 })
    $('#carousel-slide-2').carousel({ interval: 10000 })  // false until 10 seconds have passed
    $('#carousel-slide-2').carousel('pause')

    setTimeout(function() {$('#carousel-slide-2').carousel('cycle');}, 5000);

    function sendAsText(url) {
        $('#sendAsTextIframe').html(`
            <iframe src="${url}" width="450" height="550" style="margin-bottom:-90px;" frameborder="0"/>
        `);
        $('#findItIframe').html('');
        $('#modalBodyImage').html('');
        $('#modalBodyInfo').html('');
        $('#modalBodyDescription').html('');
        $('#sendAsText').html('');
    }

    function findIt(url, callNumber) {
        $('#findItIframe').html(`
            <div style="padding:20px;"><strong>Call Number</strong>: ${callNumber}</div>
            <br/>
            <iframe src="${url}" width="600" height="880" style="margin-bottom:-90px;" frameborder="0"/>`
        );
        $('#sendAsTextIframe').html('');
        $('#modalBodyImage').html('');
        $('#modalBodyInfo').html('');
        $('#modalBodyDescription').html('');
        $('#sendAsText').html('');
    }

    function updateModal(isbn, UPC, title, titleFixed, author, callNumber, location, errorImage) {
        $('#sendAsTextIframe').html('');
      
        $('#findItIframe').html('');
        $('#modalTitle').html(title + ' - ' + author);
        $('#modalBodyImage').html(`
            <div class="col-auto">
                <img class="img img-thumbnail" onerror="this.src='${errorImage}';" src="http://www.syndetics.com/index.php?isbn=${isbn}&upc=${UPC}/lc.gif&client=uncwh">
                <div class="overlay-modal">
                    <div class="text-modal">${titleFixed} - ${author}</div>
                </div>
            </div>
        `);
        if (callNumber && location) {
            $('#modalBodyInfo').html(`
                <div class="col-auto" style="text-align:center;"><strong>Call Number</strong>: ${callNumber.toUpperCase()}<br/><strong>Location</strong>: ${location}</div>
            `);
        } else {
            $('#modalBodyInfo').html(`
                <div class="col-auto" style="text-align:center;"><strong>URL</strong>: ${callNumber.toUpperCase()}</div>
            `);
        }


        location = location.replace(/[']/gi, '\\\'').replace(/["]/gi, '\\"');
        title = title.replace(/[']/gi, '\\\'').replace(/["]/gi, '\\"');
        $('#sendAsText').html(`
            <img style="margin:10px;" onclick="sendAsText('https://twilio.libapps.uncw.edu/sendCallNumber?bookLocation=${location}&bookCallNumber=${callNumber.toUpperCase()}&bookTitle=${title}');" src="/images/sendAsTxt.gif"/>
            {{#if showFindIt}}
                <img style="margin:10px;" onclick="findIt('https://findit.libapps.uncw.edu/stacks?callNumber=${callNumber}&collection=${location}', '${callNumber.toUpperCase()}');" src="/images/FindIT2-Button.png"/>
            {{/if}}
        `)
        $('#modalBodyDescription').html('<p><div id="syn_summary"></div></p>')
        syn_get_plus();
    }
</script>

<!-- Footer -->
{{!-- <center>
    <img src="/images/BottomBanner.jpg" alt="Randall Library">
</center> 
 --}}