<header id="authors-header" class="clearfix" role="banner">
  <div id="header-top" class="clearfix">
    <center>
      <img src="/images/banner_randall.jpg" alt="Randall Library">
    </center>
  </div>
</header>

<!-- creating all the carousels -->
{{#each carousels.rows as |carousel carouselId|}}
  <!-- creating one carousel row -->
  <div class="row mb-5 mt-3 book-row">
    <div class="card book-card">
      <div class="card-body">
        <!-- creating the row header elem -->
        <h5 class="card-title">
          {{carousel.title}}
          {{#if carousel.rssFeed}}
            <a href="{{carousel.rssFeed}}" target="_blank" title="Subscribe to Library {{carousel.title}} Feed">
              <img src="https://library.uncw.edu/misc/feed.png" width="16" height="16" alt="Subscribe to Library {{carousel.title}} Feed" />
            </a>
          {{/if}}
        </h5>
        <!-- creating the carousel items -->
        <div id="carousel-slide-{{increment @index}}" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
            {{#each carousel.items as |chunk chunkId|}}
              <!-- each chunk of 5 items, i.e, 5 books, cds, etc -->
              <div class="carousel-item {{#unless @index}}active{{/unless}}">
                <div class="row justify-content-center">
                  {{#each chunk as |item itemId|}}
                    <!-- each item in the chunk, i.e., a book, cd, etc -->
                    <div class="syn_skipthis col-auto book-div">
                      <img class="img img-thumbnail" src="{{item.image}}">
                      <a href="#" data-toggle="modal" data-target="#itemInfoModal" onclick="updateModal('{{safeStr item.title}}', '{{safeStr item.titleFixed}}', '{{safeStr item.authorFixed}}', '{{safeStr item.callNumber}}', '{{safeStr item.resLocation}}', '{{changeStr item.available}}', '{{item.recordnum}}', '{{item.image}}', '/images/book{{onetwothree @index}}.jpg', {{@root.carousels.showFindIt}}, {{@root.carousels.showCatalogLink}}, {{@root.carousels.showSendAsText}})">
                        <div class="overlay">
                          <div class="text">
                            {{item.titleFixed}} - {{item.authorFixed}}
                          </div>
                        </div>
                      </a>
                    </div>
                  {{/each}}
                </div>
              </div>
            {{/each}}
          </div>
          <a class="carousel-control-prev" href="#carousel-slide-{{increment @index}}" role="button" data-slide="prev">
            <span style="color:Black;">
              <i class="fas fa-arrow-circle-left fa-3x"></i>
            </span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carousel-slide-{{increment @index}}" role="button" data-slide="next">
            <span style="color:Black;">
              <span class="fas fa-arrow-circle-right fa-3x"></span>
            </span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </div>
{{/each}}

<!-- randall rotations imagebox -->
<div style="text-align:center;">
  <iframe src="https://randall-rotations.libapps-staff.uncw.edu/CircDesk/rotation" width="740px" height="1300px" style="border:none;" scrolling="no"></iframe>
</div>

<!-- modal -->
<div class="modal fade" id="itemInfoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="sendAsTextIframe"></div>
      <div id="findItIframe"></div>
      <div id="modalBodyImage" class="modal-body"></div>
      <div id="modalBodyInfo" class="modal-body" style="padding:.3rem;"></div>
      <div id="modalBodyDescription" class="modal-body"></div>
      <div id="modalRefreshers" class="row text-center">
        <div id="sendAsText" class="col-md-4 col-sm-12"></div>
        <div id="catalogLink" class="col-md-4 col-sm-12"></div>
        <div id="findIt" class="col-md-4 col-sm-12"></div>
      </div>
      <div id="openCatalog" class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  $('#carousel-slide-1').carousel({
    interval: 10000
  })

  $('#carousel-slide-2').carousel({ // false until 10 seconds have passed
    interval: 10000
  })

  $('#carousel-slide-2').carousel('pause')

  setTimeout(function() {
    $('#carousel-slide-2').carousel('cycle');
  }, 5000);


  function updateModal(title, titleFixed,  author, callNumber, location, available, recordnum, image, errorImage, showFindIt, showCatalogLink, showSendAsText) {
    const formattedCallNumber = callNumber.toUpperCase().replace(/\s/g, '');
    const formattedLocation = location.replace(/[']/gi, '\\\'').replace(/["]/gi, '\\"');
    const formattedTitle = title.replace(/[']/gi, '\\\'').replace(/["]/gi, '\\"');
    const findItUrl = `https://findit.libapps.uncw.edu/stacks?callNumber=${formattedCallNumber}&collection=${formattedLocation}`
    const sendTextUrl = `https://twilio.libapps.uncw.edu/sendCallNumber?bookLocation=${formattedLocation}&bookCallNumber=${formattedCallNumber}&bookTitle=${formattedTitle}`

    $('#sendAsTextIframe').html('');
    $('#findItIframe').html('');
    $('#modalBodyImage').html('');
    $('#modalBodyInfo').html('');
    $('#modalBodyDescription').html('');
    $('#sendAsText').html('');
    $('#catalogLink').html('');
    $('#findIt').html('');
    
    $('#modalTitle').html(`${title} - ${author}`);
    $('#modalBodyImage').html(`
      <div class="col-auto">
        <img class="img img-thumbnail" onerror="this.src='${errorImage}'" src="${image}">
        <div class="overlay-modal">
          <div class="text-modal">${titleFixed} -- ${author}</div>
        </div>
      </div>
    `);

    if (callNumber && location) {
      $('#modalBodyInfo').html(`
        <div class="col-auto" style="text-align:center;">
          <strong>Call Number</strong>: ${formattedCallNumber}
          <br/>
          <strong>Location</strong>: ${location}
          <br/>
          <strong>Availability</strong>: ${available}
        </div>
      `);
    } else {
      $('#modalBodyInfo').html(`
        <div class="col-auto" style="text-align:center;">
          <strong>Click on button "See Catalog Record" to access Electronic Resource</strong>: ${formattedCallNumber}
        </div>
      `);
    }
    if (showSendAsText) {
      $('#sendAsText').html(` 
        <img style="margin:10px;" onclick="sendAsText('${sendTextUrl}');" src="/images/sendAsTxt.gif"/>
      `);
    };
    if (showCatalogLink) {
      $('#catalogLink').html(`
        <a target="blank" href="https://libcat.uncw.edu/record=b${recordnum}">
          <img style="margin:10px;" src="/images/catalogRecord.gif"/>
        </a>
      `);
    };
    if (showFindIt) {
      $('#findIt').html(`
        <img style="margin:10px;" onclick="findIt('${findItUrl}', '${formattedCallNumber}');" src="/images/FindIT2-Button.png"/>
      `);
    };
   
    $('#modalBodyDescription').html(`<p><div id="syn_summary"></div></p>`)
    
    syn_get_plus();
  }

  function sendAsText(url) {
    $('#sendAsTextIframe').html('');
    $('#findItIframe').html('');
    $('#modalBodyImage').html('');
    $('#modalBodyInfo').html('');
    $('#modalBodyDescription').html('');
    $('#sendAsText').html('');
    $('#catalogLink').html('');
    $('#findIt').html('');

    $('#sendAsTextIframe').html(`
        <iframe src="${url}" width="450" height="550" style="margin-bottom:-90px;" frameborder="0"/>
    `);
  }

  function findIt(url, callNumber) {
    $('#sendAsTextIframe').html('');
    $('#findItIframe').html('');
    $('#modalBodyImage').html('');
    $('#modalBodyInfo').html('');
    $('#modalBodyDescription').html('');
    $('#sendAsText').html('');
    $('#catalogLink').html('');
    $('#findIt').html('');
    
    $('#findItIframe').html(` 
      <div style="padding:20px;"><strong>Call Number</strong>: ${callNumber}</div>
      <br/>
      <iframe src="${url}" width="600" height="880" style="margin-bottom:-90px;" frameborder="0"/>
    `);

  }

</script>